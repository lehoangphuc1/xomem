1.目的
本システム設計書は、Microsoft365で検認ワークフローシステムの新規プロジェクトについて定めるものである。
本プロジェクトでは、MPSと協力会社の両方に使用できる検認ワークフローシステムを作成し、あわせて、Microsoft365とクラウド環境にドキュメントを保存して、管理するものである。
2.システム構成
システム構成を示す。
 










 
3.ソフトウェア構成

 






















 
4.グループ構成とアクセス権
4.1 グループ構成
	最上位グループはサイトの所有者、MPSと協力会社がある。
最上位グループ	内容
所有者	スーパーユーザのグループ
MPS	MPSプロパー社員のグループ。組織構成の通りに下位グループを作る。
協力会社	協力会社社員のグループ

組織構成を以下に示す。
 
Microsoft365のSharePointでは下位グループを上位グループに追加するので、まずは下位グループを作って、メンバーを追加して、上位グループに下位グループを追加する。
ユーザは兼務がある場合、そのユーザはメイングループと兼務グループの両方で所属する。
上位，下位に関係なく，グループ毎にグループの所有者が設定できる。
 
4.2 アクセス権
	4.2.1 権限レベル
必要な基本権限レベルは表示、編集、追加、削除がある。
以下はMicrosoft365のSharePointの基本権限によって提供される。
 

Microsoft365のSharePointは基本権限レベルから新規権限レベルを作成できる。
例えば：表示-追加：ユーザは項目を表示し、追加できる。
	
 
	4.2.2　ドキュメントの権限
	グループの通りにドキュメントライブラリの権限を設定する。
 
フォルダごとに1つまたは複数のグループの権限を設定でき、グループごとに権限レベルを変更できる。
 

	ドキュメントの種類の通りに権限を設定する。
一般ユーザに対して読み取り専用のドキュメント種類がある。（承認済み、検認履歴一覧、…）。このドキュメントのフォルダのアクセス権は一般ユーザが読み取り専用、管理ユーザのみが編集できる。
 
4.2.3 サイトの権限
ユーザのサイトのアクセス権が設定できる。
以下はMicrosoft365のSharePointのサイトの基本権限です。
 
5.要求仕様
 
以上は基本となる申請から承認の図
申請者は申請書から必要な情報を入力して、「申請」ボタンを押下する。
申請書がSharePointにアプロードされる。アプロードされた後、検認フローが自動的に起動する。
検認フローは検認者へ検認依頼メールを送信する。検認者は検認依頼メールを受けた後、検認を実施する（申請書を見るし、コメントを入力して、検認結果を決める。）
検認フローは検認結果を受けた後、申請者へ検認結果のメールを送信して、次の検認者へ検認依頼のメールを送信する。
検認が完了した後（最後の検認ステップの場合）、申請書を処理済フォルダへ移動する。最後検認履歴を保存する。申請書を削除する。





5.1 申請者（社員）の申請処理 
以上の図は当社申請者の活動を記載する。
MPSのメンバーはMPS用の申請書に申請情報を入力する。
申請情報を入力する時点に検認者一覧の中に欠席の人がいることを知れば、「申請書の検認ルート」シートの「検認ルート」テーブルに代理人所属と代理人役職を入力する。
 
必要な情報をすべて入力した後、「保存・申請」ボタンを押下。検認結果のメールを待つ。
「保存・申請」ボタンを押下した後、検認者一覧の中に欠席の人がいることを気付ければ、SharePointにExcel Onlineで申請書を開いて、「申請書の検認ルート」シートの「検認ルート」テーブルに代理人所属と代理人役職を入力して、「再検認」セールの値を「YES」に変更して、保存する。検認結果のメールを待つ。
 

5.2 申請者（協力会社員）の申請処理 
以上の図は協力会社の申請者の活動を記載する。
MPSのメンバーは協力会社用の申請書に申請情報を入力する。
申請情報を入力する時点に検認者一覧の中に欠席の人がいることを知れば、「申請書の検認ルート」シートの「検認ルート」テーブルに代理人所属と代理人役職を入力する（その検認者は各社責任者の場合はプールダウンに値を選択する）。
必要な情報をすべて入力した後、「保存・申請」ボタンを押下。検認結果のメールを待つ。
「保存・申請」ボタンを押下した後、検認者一覧の中に欠席の人がいるを気付ければ、SharePointにExcel Onlineで申請書を開いて、「申請書の検認ルート」シートの「検認ルート」テーブルに代理人所属と代理人役職を入力して（その検認者は各社責任者の場合はプールダウンに値を選択する）、「再検認」セールの値を「YES」に変更して、保存する。検認結果のメールを待つ。

5.3　検認者の承認・検認処理
 
以上の図は検認者の活動
検認依頼のメールを受けた後、受けたメールにリンクをクリックして、検認依頼の申請書を
見える。受けたメールに「検認」、「可否」また「不要」を押下することで検認結果を決める。
検認者は受けたメールに「検認」、「可否」また「不要」を押下した後、コメントを入力できる。
「確認」ボタンを押下する。
検認者は他の人の代わりに検認して欲しい場合、受けたメールに「検認」、「可否」また「不要」を押下した後、プールダウンに「Reassign」の値を選択して、他の人のメールを入力して、「確認」ボタンを押下。





6.フローの必要な成分を設定
6.1 データベースファイル（従業員情報）
このファイルに当社と協力会社のユーザ情報、所属、役職情報を保存する。
	当社会社員情報はデータベースファイル（従業員情報）の「haru16」テーブルに保存する。
以下のテーブルは「haru16」テーブルの構成
列	内容	データベースのharu16テーブルの相応列
manno	マンナンバー	manno
name	名前	name
shozoku_code	所属コード	shozoku_code
yakushoku_code	役職コード	yakushoku_code
mail_address	メール	mail_address
shozoku_code_kenmu_1	所属コード兼務１	shozoku_code_kenmu_1
shozoku_code_kenmu_2	所属コード兼務２	shozoku_code_kenmu_2
shozoku_code_kenmu_3	所属コード兼務３	shozoku_code_kenmu_3
shozoku_code_kenmu_4	所属コード兼務４	shozoku_code_kenmu_4
yakushoku_code_kenmu_1	役職コード兼務１	yakushoku_code_kenmu_1
yakushoku_code_kenmu_2	役職コード兼務２	yakushoku_code_kenmu_2
yakushoku_code_kenmu_3	役職コード兼務３	yakushoku_code_kenmu_3
yakushoku_code_kenmu_4	役職コード兼務４	yakushoku_code_kenmu_4
データベースファイル（従業員情報）の「haru16」テーブルのデータはデータベースのharu16テーブルに「onoff = 1」の条件で取得する。
	当社会社員の所属情報はデータベースファイル（従業員情報）の「haru16_shozoku」テーブルに保存する。
以下のテーブルは「haru16_shozoku」テーブルの構成
列	内容	データベースのharu16_shozokuテーブルの相応列
shozoku_code_no	所属コード	shozoku_code_no
shozoku_name	所属名	shozoku_name
shozoku_ryakusho	所属略称	shozoku_ryakusho
データベースファイル（従業員情報）の「haru16_shozoku」テーブルのデータはデータベースのharu16_shozokuテーブルに「shozoku_jissou = 1」の条件で取得する。
以下はデータベースファイル（従業員情報）の「haru16_shozoku」テーブルのデータのサンプル
 
	当社会社員の役職情報はデータベースファイル（従業員情報）の「haru16_yakushoku」テーブルに保存する
以下のテーブルは「haru16_shozoku」テーブルの構成
列	内容	データベースのharu16_yakushokuテーブルの相応列
yakushoku_code_no	役職コード	yakushoku_code_no
yakushoku_name	役職名	yakushoku_name
yakushoku_ryakusho	役職略称	yakushoku_ryakusho
データベースファイル（従業員情報）の「haru16_yakushoku」テーブルのデータはデータベースのharu16_yakushokuテーブルに取得する。
以下はデータベースファイル（従業員情報）の「haru16_yakushoku」テーブルのデータのサンプル

 
	協力会社員情報はデータベースファイル（従業員情報）の「haru17」テーブルに保存する
以下のテーブルは「haru17」テーブルの構成
列	内容	データベースのharu17テーブルの相応列
man_no	マンナンバー	man_no
shimei	名前	shimei
mail_address	メール	mail_address
shozoku_code	所属コード	shozoku_code
name_ryakusho	行先表示の名前	name_ryakusho
work_place	勤務の場所	work_place
kanri_sekininsya	管理責任者	kanri_sekininsya
データベースファイル（従業員情報）の「haru17」テーブルのデータはデータベースのharu17テーブルに「onoff = 1」の条件で取得する。
以下はデータベースファイル（従業員情報）の「haru17」テーブルのデータのサンプル
 
データベースファイル（従業員情報）は「Database.xlsx」ファイルを参照
6.2 検認履歴
一時的な検認情報を保存する場所です。
一時的な検認情報は「検認履歴.xlsx」ファイルの「検認履歴一覧」テーブルに保存する。
以下は「検認履歴一覧」の構成
列	内容
申請日時	申請日時
申請者	申請者の名前
申請項目	申請書の氏名
承認者	承認者の名前
承認可否	検認結果
承認日時	承認日時
コメント	コメント
ステップ	現在の検認ステップ
「検認履歴.xlsx」ファイルを参照

6.3 最後検認履歴
検認が終了の時、検認結果を保存する場所です。
最後の検認結果は「最後検認履歴.xlsx」の「最後検認履歴一覧」テーブルに保存する。
以下は「最後検認履歴一覧」テーブルの構成
列	内容
申請項目	申請書の氏名
申請者	申請者の名前
申請日時	申請日時
承認者	１番目の承認者の名前
承認可否	１番目の検認結果
承認日時	１番目の承認日時
コメント	１番目の検認者のコメント
承認者1	2番目の承認者の名前
承認可否1	2番目の検認結果
承認日時1	2番目の承認日時
コメント1	2番目の検認者のコメント
承認者2	3番目の承認者の名前
承認可否2	3番目の検認結果
承認日時2	3番目の承認日時
コメント2	3番目の検認者のコメント
承認者3	4番目の承認者の名前
承認可否3	4番目の検認結果
承認日時3	4番目の承認日時
コメント3	4番目の検認者のコメント
承認者4	5番目の承認者の名前
承認可否4	5番目の検認結果
承認日時4	5番目の承認日時
コメント4	5番目の検認者のコメント
承認者5	6番目の承認者の名前
承認可否5	6番目の検認結果
承認日時5	6番目の承認日時
コメント5	6番目の検認者のコメント
承認者6	7番目の承認者の名前
承認可否6	7番目の検認結果
承認日時6	7番目の承認日時
コメント6	7番目の検認者のコメント
承認者7	8番目の承認者の名前
承認可否7	8番目の検認結果
承認日時7	8番目の承認日時
コメント7	8番目の検認者のコメント
承認者8	9番目の承認者の名前
承認可否8	9番目の検認結果
承認日時8	9番目の承認日時
コメント8	9番目の検認者のコメント
承認者9	10番目の承認者の名前
承認者9	１0番目の検認結果
承認可否9	１0番目の承認日時
承認日時9	１0番目の検認者のコメント
すべて検認ステップの結果を保存する。
例えば：検認者は３人が検認した、検認者から検認者２までデータがある。
「最後検認履歴.xlsx」ファイルを参照
 
6.4 検認ルートリスト
SharePointのリストにMPSの組織構成から検認ルートリストを作成。
目的は申請者の上長を取得すること。
2020/11/18時点のMPSの組織構成を以下に示す。
 
検認ルートリスト
 
 
6.5 検認リスト
一時的な検認情報を保存する場所というリストです。
列名	Type	備考
フォルダ名	text	
ファイル名	text	
申請時間	Date time	
現在ステップ	Number	
ステータス	Choice	完了/進行中
File_Identifier	Multi text	SharePointに申請書のID
先検認者メール	Multi text	検認した検認者のメール、”;”が分離される。

7. フロー
検認ワークフローごとは二つフローを含む。
	検認フロー開始フロー
このフローはドキュメントライブラリへ接続する。ドキュメントライブラリにファイルがアプロードする、またはファイルを変更するかつ「再検認フラグ＝YES」は検認フローを開始する。
	検認フロー
Microsoft365のメールでデータベースファイル（従業員情報）から申請者の情報を取得し、
申請書の「検認ルート」というテーブルのデータでデータベースファイル（従業員情報）から検認者の情報を取得して、検認メールを作成して、検認結果を待って受ける。検認結果を受ける時、申請者へ検認結果をメールで連絡し、申請書に検認結果を変更する。検認が終了時、「承認済み」というフォルダに申請書を移動し、最後検認履歴を追加する。
 
7.1検認フロー開始フロー
 
検認フロー開始フローについて、MPS用と協力会社用は同じです。
7.2 検認フロー
7.2.1 MPS用の検認フロー
「MPS用の検認フロー.pdf」ファイルを参照
7.2.2 協力会社用の検認フロー
「協力会社用の検認フロー.pdf」ファイルを参照
8. 保守
8.1 検認ルートリスト
MPSの組織構成に変更があれば、SharePointの検認ルートリストを手動で更新する。
例えば：MPSの組織構成が以下のようになった場合
 

SharePointの検認ルートリストに以下の1レコードを追加する。
20X_K→20A_RM→00A_P

検認ルートリストの編集は以下のように実施する。

 

 

 

 

8.2 データベースファイル（従業員情報）
データベースに会社員情報が変更される時、SharePointにデータベースファイル（従業員情報）も更新しないといけない。

8.3 組織変更に伴うグループ員の変更やアクセス権
データベースファイル（従業員情報）が更新された後、グループ員の変更やアクセス権フローを起動する。
このフローはグループ員とアクセス権を更新する。
このフローはデータベースファイル（従業員情報）が更新されれば自動で実行される。
フロー詳細：
 
新しいグループを作成する場合、フォルダのアクセス権の設定は手動で行う。
